
> **📝 摘要**：本文详细介绍滑块拼图游戏在n×n和n×2棋盘上的完整解决方案，包括核心概念、操作原理和具体实现步骤。
---
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/78e6ea33bbdf4e05aff3502337f98cc6.png)



# 🎯 基本概念与约定

本文主要讨论以下两类棋盘：
- **n×n棋盘**：标准正方形棋盘
- **n×2棋盘**：特殊矩形棋盘

## 🎲 座
棋盘的一个位置为一个**座**，用 [$a_{11}, a_{12}, \ldots, a_{nn}$] 
或$[a_1, a_2, \ldots, a_{n^2}]$ 表示
$$
A = \begin{pmatrix}
a_{11} & a_{12} & \cdots & a_{1n} \\
a_{21} & a_{22} & \cdots & a_{2n} \\
\vdots & \vdots & \ddots & \vdots \\
a_{n1} & a_{n2} & \cdots & a_{nn}
\end{pmatrix}
$$
其中 $a_{ij}$=$a_{(i-1)n+j}$
## 🔗 邻座
一个座的上下左右的座，叫它的**邻座**

## 🏁 棋盘边座
$a_{1j}, a_{nj}, a_{j1}, a_{jn}$  ( j取1到n) 的座是**棋盘边座**, 即 挨着棋盘边的那些座。

## 🔲 滑块 （块）
能够移动的方块叫**滑块**，用 $1, 2, 3, \ldots, n^2$ 表示，其中 $n^2$ 是 **空块**

### 🕳️ 空块
- 计算棋盘逆序数时用 $n^2$ 表示空块
- 展示操作步骤时用 $0$ 表示空块

### 🔗 邻块
一个块的上下左右的块，叫它的**邻块**

## 🎯 块分类
- **关键块**：需要关注的块，用数字表示
- **无关块**：无需关注的块，用字母表示 
  - **确定无关块**：用字母 $a, b, c, d, e$ 表示
  - **不确定无关块**：用字母 $x$ 表示

## 🔄 回路
- **回路**：从一个座出发，经过一系列邻座后回到该座的路径
- **含空回路**：包含空块的回路
- **边回路**：棋盘边座形成的含空回路

## ⚙️ 操作
- **P1**：空块和其邻块交换叫做**操作**
- **P2**：含空回路中的块可以沿着含空回路顺时针流动 或 逆时针流动

## 🔒 锁定
块到达某座后不再移动，叫做该块已**锁定**


---

# 🔲 n×n 棋盘操作步骤

## 📝 算法流程

### 第一步：构建第一行前半部分
1. **运输块1**：找到经过 块1 和 $a_{11}$ 的含空回路，将块1运输到 $a_{11}$
2. **运输块2**：找到经过 块2和 $a_{12}$ 的含空回路，将块2运输到 $a_{12}$
3. **继续运输**：重复上述过程，将块1到块(n-1)分别运输到对应位置

### 第二步：完成第一行
4. **逆时针旋转**：
   - 保持块1到块(n-1)不动
   - 将空块移动到棋盘边
   - 利用边回路，将块1到块(n-1)整体逆时针转一格
   - 此时 $a_{1,n-1}$ 处是空块

5. **运输最后一块**：找到经过块n和 $a_{1,n-1}$ 的含空回路，将块n运输到 $a_{1,n-1}$

6. **顺时针调整**：
   - 将空块移动到棋盘边
   - 用边回路将块1到块n整体顺时针转一格
   - **第一行完成** ✅

### 第三步：处理剩余行
7. **锁定第一行**，重复上述步骤将前(n-2)行拼好

### 第四步：问题转换
8. **旋转棋盘**：将棋盘整体顺时针旋转90°，问题转换为n×2棋盘问题

---

# 📐 n×2 棋盘操作步骤
### 第一步：处理第一行
1. **运输块1**：利用边回路将块1运输到 $a_{11}$
   - 如果此时块2在 $a_{12}$，则第一行拼好 ✅
   - 如果块2不在 $a_{12}$，需要进行调整

### 🔄 特殊情况处理

当块2不在正确位置时，可能出现以下情况：

```bash
1a
20
bc
```

**目标**：将上述状态转换为
```bash
12
xx
xx
```

#### 📋 三步转换过程

**第一步**：回路 `20cb` 顺时针转为
```bash
1a
b0
c2
```

**第二步**：回路 `1a0b` 顺时针转为
```bash
b1
a0
c2
```

**第三步**：边回路逆时针转为
```bash
12
b0
ac
```

### 第二步：处理剩余行
2. **重复操作**：重复上述步骤将前(n-2)行拼好

### 第三步：最后两行判断
3. **可行性判断**：
   - ✅ **可拼好**：如果最后两行经过边回路旋转能拼好
   - ❌ **无法拼好**：如果最后两行无法通过边回路旋转拼好


# 棋盘的逆序数
棋盘中空块的位置决定了棋盘逆序数的奇偶性,假设棋盘的最后一格是黑色的，正常的棋盘当空块位于黑格时，逆序数为偶；位于白格时，逆序数为奇。若交换任意两个滑块，棋盘的逆序数的奇偶性将发生变化，对应地，棋盘的黑白格也互换了，造成无法拼好。
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/a9349b7b5c04456093559cc71378ab40.jpeg)
# 逆序定理

## 定义

设 $S = [a_1, a_2, \dots, a_m]$ 为一个排列，其**逆序数**定义为：
$$
I(S) = \# \{ (i,j) \mid 1 \le i < j \le m, a_i > a_j \}
$$
即所有满足 $i < j$ 但 $a_i > a_j$ 的数对 $(i,j)$ 的个数。

---

## 定理（逆序数奇偶性定理）

**定理：** 交换排列中任意两个元素，逆序数的奇偶性改变。

**形式化表述：** 设 $S'$ 是由 $S$ 交换位置 $p$ 和 $q$（$p < q$）的两个元素得到的排列，则
$$
I(S') \equiv I(S) + 1 \pmod{2}
$$

---

## 证明

### 引理：相邻交换的影响

**引理：** 交换相邻两个元素，逆序数恰好改变 $\pm 1$。

**证明：** 设交换位置 $k$ 和 $k+1$ 的元素 $a_k$ 和 $a_{k+1}$。
- 除了涉及 $a_k$ 和 $a_{k+1}$ 的逆序对，其他逆序对都不受影响
- 涉及 $a_k$ 和 $a_{k+1}$ 与其他元素的逆序关系也不变
- 唯一的变化是 $(a_k, a_{k+1})$ 这一对的关系：
  - 若交换前 $a_k < a_{k+1}$，则交换后形成逆序，$I$ 增加 $1$
  - 若交换前 $a_k > a_{k+1}$，则交换后消除逆序，$I$ 减少 $1$

因此，**相邻交换使逆序数改变奇数次（$\pm 1$）**。 ∎

---

### 主定理证明

现在证明交换**任意**两个位置的元素对逆序数奇偶性的影响。

设要交换位置 $p$ 和 $q$（$p < q$）的元素，在它们之间有 $r = q - p - 1$ 个元素：
$$
\underbrace{a_p}_{\text{位置 }p}, \underbrace{a_{p+1}, a_{p+2}, \dots, a_{q-1}}_{r \text{ 个元素}}, \underbrace{a_q}_{\text{位置 }q}
$$

**策略：** 将非相邻交换分解为多次相邻交换。

**步骤 1：** 将 $a_p$ 通过相邻交换向右移动到位置 $q-1$

执行 $r$ 次相邻交换：
$$
\begin{aligned}
&a_p, a_{p+1}, \dots, a_{q-1}, a_q \\
\xrightarrow{\text{交换 }1} &a_{p+1}, a_p, a_{p+2}, \dots, a_{q-1}, a_q \\
\xrightarrow{\text{交换 }2} &a_{p+1}, a_{p+2}, a_p, \dots, a_{q-1}, a_q \\
&\vdots \\
\xrightarrow{\text{交换 }r} &a_{p+1}, a_{p+2}, \dots, a_{q-1}, a_p, a_q
\end{aligned}
$$

逆序数变化：$r$ 次相邻交换 → 改变 $r$ 次（模2意义下）

**步骤 2：** 将 $a_q$ 通过相邻交换向左移动到位置 $p$

执行 $r+1$ 次相邻交换（需要越过 $r$ 个中间元素和现在位置 $q-1$ 的 $a_p$）：
$$
\begin{aligned}
&a_{p+1}, a_{p+2}, \dots, a_{q-1}, a_p, a_q \\
\xrightarrow{\text{交换 }1} &a_{p+1}, a_{p+2}, \dots, a_{q-1}, a_q, a_p \\
\xrightarrow{\text{交换 }2} &a_{p+1}, a_{p+2}, \dots, a_q, a_{q-1}, a_p \\
&\vdots \\
\xrightarrow{\text{交换 }r+1} &a_q, a_{p+1}, a_{p+2}, \dots, a_{q-1}, a_p
\end{aligned}
$$

逆序数变化：$r+1$ 次相邻交换 → 改变 $r+1$ 次（模2意义下）

**步骤 3：** 计算总变化

总共进行了
$$
r + (r+1) = 2r + 1
$$
次相邻交换。

由于每次相邻交换都改变逆序数的奇偶性，而 $2r+1$ 是**奇数**，因此：
$$
I(S') \equiv I(S) + 1 \pmod{2}
$$

即**逆序数的奇偶性改变**。 ∎