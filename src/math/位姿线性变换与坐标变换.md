
# 位姿、线性变换与坐标变换

位姿、线性变换、坐标变换其实是同一个矩阵 $^A_BT$ 在不同视角下的名字。内旋、外旋、左乘、右乘容易混淆，是因为缺少科学的符号。一旦问题复杂，直观和直觉靠不住，只能靠代数符号推理。

为了简化符号，数学上经常会用同一个符号来表示能够相互确定的一组对象，比如：

A 可能指：{参考系、参考系的一组基、基张成的列空间、参考系的矩阵、一个线性变换、线性变换对应的矩阵}。

但在具体场景下，A只可能是其中的一个。

例如：

- $^A_BT = A^{-1}B$ 中左边的A是参考系，右边的A是矩阵，两者可以相互确定。
- $P_2 = AP_1$ 中的A是矩阵，$P_2 = A(P_1)$ 中的A是线性变换，大多数情况无需区分。

$^A_BT$ 有三个含义（矩阵形式一样，能相互确定）：

- P1: B系在A系中的位姿（姿态矩阵）
- P2: A系到B系的过渡矩阵（用于坐标变换）
- P3: A系到B系的运动算子作用（用于线性变换）

---

## 约定

-  A, B, C 是空间中的参考系或其标准正交基，或正交基对应的矩阵。
- T, R, M 是线性变换或其矩阵。
- $^A T$ 特指A系中的线性变换或其矩阵。
- P, $P_1$, $P_2$ 是与参考系无关的点。
- $^A P$ 是点P在A系中的坐标列向量。
- 符号左上角和左下角是两个参考系。

-  $[a_1, a_2, ..., a_n]$ 是A系的基，$[b_1, b_2, ..., b_n]$ 是B系的基，$a_j$ 和 $b_j$ 都是n维列向量。
  一个坐标系可以用它的基表示，故 $A=[a_1, ..., a_n]$，$B=[b_1, ..., b_n]$。$a_j$ 和 $b_j$ 的表示依赖世界系 $[e_1, ..., e_n]$。

- $^A P$ 是点P在A系中的齐次坐标 $^A [P_x, P_y, P_z, 1]^T$ 或欧式坐标 $^A [P_x, P_y, P_z]^T$，根据上下文区分。

-  $^A T$ 是A系中的线性变换，满足 $^A P_2 = ^A T \cdot ^A P_1$（即把 $P_1$ 变换到 $P_2$）。

-  $^{\mathbf{A}}_{\mathbf{B}}\mathbf{T}$ 是B系在A系中的位姿，指系B每个基在A系的坐标表示，即：

  $[b_1, ..., b_n] = [a_1, ..., a_n] \cdot {^A_BT}$

  $^A_BT = A^{-1}B$

  $^B_AT = B^{-1}A$

  $^A_BT \cdot ^B_AT = I$

- 常用线性变换用“作用”描述，如拉伸、旋转、平移、镜像、透视，抽象线性变换只能用矩阵描述。

-  作用M是线性变换，M乘点是对点变换，M乘矩阵可看作对多个点变换，也可看作对坐标系变换。

- 线性变换M在A系的矩阵 $^A M$ 与在B系的矩阵 $^B M$ 是相似矩阵。

  $^A P_2 = ^A M ^A P_1$

  $^B P_2 = ^B M ^B P_1$

  $^B P_2 = ^B_AT \ ^A M \ ^A_BT \ ^B P_1$

  $^B M = ^B_AT \ ^A M \ ^A_BT = ^B_AT \ ^A M \ (^B_AT)^{-1}$

---

# 定理1：坐标变换定理

$^A P = ^A_BT \ ^B P$

坐标变换定理描述了同一个点P在两个系中的关系。

- $B = [b_1, ..., b_n] = [a_1, ..., a_n] C = AC$，C是[过渡矩阵](https://baike.baidu.com/item/%E8%BF%87%E6%B8%A1%E7%9F%A9%E9%98%B5)
- $^A P = [p_1, ..., p_n]^T$，$^B P = [p_1', ..., p_n']^T$，$P = A ^A P = B ^B P = AC ^B P$
- $^A P = C ^B P$，C就是 $^A_BT$
- 若A取$I=[e_1, ..., e_n]$，则 $B = C = ^A_BT$

---

# 定理2：线性变换定理

$^A P_2 = ^A_BT \ ^A P_1$

令 $^A P_2 = M ^A P_1$

线性变换定理描述了在同一个系中两个点的关系（线性变换的特点是左上角在一个系中）。

M 产生的作用就是A系到B系的作用，B系是假想出来的，$P_1$跟随B系一起运动到达$P_2$。

$P_2$在B系的坐标和$P_1$在A系的坐标一样，假定为 $V= [v_1, ..., v_n]^T$。

即有：

- $^B P_2 = ^A P_1 = V$
- $P_1 = A ^A P_1 = AV$
- $P_2 = B ^B P_2 = BV$
- $^A P_2 = M ^A P_1 = ^A_BT \ ^B P_2 = ^A_BT \ ^A P_1$

故 $M = ^A_BT$

---

# 定理3：链式变换定理

$^A_CT = ^A_BT \ ^B_CT$

不同解释延伸出有趣的内外旋定理。

- $^A P = ^A_BT ^B P = ^A_CT ^C P$
- $^B P = ^B_CT ^C P$
- $^A P = ^A_BT ^B_CT ^C P = ^A_CT ^C P$
- $^A_BT ^B_CT = ^A_CT$

---

# 定理4：内外旋定理

该定理源于 $^A_CT = ^A_BT ^B_CT$ 的两种解释。

- 本地系的作用是内旋用右乘。
- 世界系作用是外旋用左乘。

![](https://i-blog.csdnimg.cn/img_convert/ef65dc5f357208a46e9038e9bb11d7a0.png)

达到上图状态有两种方式：

**方式1：运动系，内旋，右乘**
- ABC重合
- BC相对A运动 $^A_BT$
- C相对B运动 $^B_CT$
- $^A_CT = ^A_BT ^B_CT$，即先 $^A_BT$ 作用，后 $^B_CT$ 作用，都是相对运动系作用。

**方式2：世界系，外旋，左乘**
- ABC重合
- C相对AB运动 $^B_CT$
- BC相对A运动 $^A_BT$
- $^A_CT = ^A_BT ^B_CT$，即先 $^B_CT$ 作用，后 $^A_BT$ 作用，都是相对世界系作用。

---

# 例1：平面上绕点 $(x, y)$ 逆时针旋转 $\theta$ 的线性变换 $M$

- A系为世界系
- B系由A系平移到 $(x, y)$ 得到
- C系由B系逆时针旋转 $\theta$ 得到
- $P_1$ 绕B系原点逆时针旋转 $\theta$ 到达 $P_2$，求在A系中 $P_1$ 到 $P_2$ 的线性变换 $M$，即 $^A M$

![](https://i-blog.csdnimg.cn/img_convert/a8ab20349664346b596b50a41fb51f12.png)

$$
^A P_1 = ^A_BT ^B_CT ^C P_1
$$
$$
^A P_2 = ^A_BT ^B_CT ^C P_2
$$
$$
^C P_2 = ^B_CT ^C P_1
$$
$$
^A P_2 = M ^A P_1
$$

联立上式可解得 $M = ^A_BT ^B_CT ^B_AT$，可见 $M$ 与 $^B_CT$ 是相似阵。

这是因为绕 $(x, y)$ 旋转 $\theta$ 这个线性变换在A系中的矩阵是 $M$，在B系中的矩阵是 $^B_CT$，线性变换在不同基中的矩阵是相似阵。
将

$$
{^A_B}\mathbf{T} = \begin{pmatrix} 1 & 0 & x \\ 0 & 1 & y \\ 0 & 0 & 1 \end{pmatrix}
$$

$$
{^B_C}\mathbf{T} = \begin{pmatrix} \cos\theta & -\sin\theta & 0 \\ \sin\theta & \cos\theta & 0 \\ 0 & 0 & 1 \end{pmatrix}
$$

$$
{^B_A}\mathbf{T} = \left( {^A_B}\mathbf{T} \right)^{-1} = \begin{pmatrix} 1 & 0 & x \\ 0 & 1 & y \\ 0 & 0 & 1 \end{pmatrix}^{-1}
$$

带入上式得到：

$$
\mathbf{M} = \begin{pmatrix}
\cos\theta & -\sin\theta & (1 - \cos\theta)x + \sin\theta\, y \\
\sin\theta & \cos\theta & -\sin\theta\, x + (1 - \cos\theta)y \\
0 & 0 & 1
\end{pmatrix}
$$

其中 $\mathbf{M}$ 表示在世界系下，绕点 $(x, y)$ 逆时针旋转 $\theta$ 的齐次变换矩阵。
---

# 例2：三维空间中绕定轴 $k$ 旋转 $\theta$ 的线性变换 $M$
这个就是 罗德里格旋转公式的纯代数推导

- $k$ 为定轴方向矢量，作用 $M$ 是将点绕 $k$ 轴旋转 $\theta$
- A为世界系
- A'、B' 的z轴与 $k$ 重合
- B系由A系绕 $k$ 轴旋转 $\theta$ 得到，B'由A'绕 $k$ 轴旋转 $\theta$ 得到
- B系在A系中的位姿就是 $M = ^A_BR$

当 $\theta=0$ 时，A与B重合，A'与B'重合，$M$ 作用于A和A'得到B和B'。

$B = M(A) = MA$（M把A系变成B系）

$B' = M(A') = MA'$

$B^{-1}B' = (MA)^{-1}MA' = A^{-1}A'$

$^A_{A'}R = ^B_{B'}R = [n, o, k]$（k为定轴，n和o可略去）

A为世界系，A'在A中的位姿为 $[n, o, k]$

![](https://i-blog.csdnimg.cn/img_convert/544c4e0ddc87f499973603e9445e76be.png)


# Rodrigues 旋转公式

### 1. 向量旋转公式
已知：
- 单位旋转轴 **u** = $(u_{x}, u_{y}, u_{z})$
- 旋转角度 $\theta$
- 原向量 **p** = $(p_{x}, p_{y}, p_{z})$

旋转后向量 **p'**：
$$
\mathbf{p}' =
\underbrace{\mathbf{p}\cos\theta}_{\text{① 垂直于轴的分量旋转后投影}}
\;+\;
\underbrace{(\mathbf{u}\times\mathbf{p})\sin\theta}_{\text{② 垂直分量的 90° 旋转}}
\;+\;
\underbrace{\mathbf{u}(\mathbf{u}\cdot\mathbf{p})(1-\cos\theta)}_{\text{③ 平行于轴的分量补偿}}
$$



---

### 2. 矩阵形式
$$
R =
\begin{bmatrix}
\cos\theta + u_{x}^2(1-\cos\theta) &
u_{x}u_{y}(1-\cos\theta) - u_{z}\sin\theta &
u_{x}u_{z}(1-\cos\theta) + u_{y}\sin\theta \\[4pt]
u_{y}u_{x}(1-\cos\theta) + u_{z}\sin\theta &
\cos\theta + u_{y}^2(1-\cos\theta) &
u_{y}u_{z}(1-\cos\theta) - u_{x}\sin\theta \\[4pt]
u_{z}u_{x}(1-\cos\theta) - u_{y}\sin\theta &
u_{z}u_{y}(1-\cos\theta) + u_{x}\sin\theta &
\cos\theta + u_{z}^2(1-\cos\theta)
\end{bmatrix}
$$

---

### 3. 齐次矩阵形式（绕直线 AB）
如果旋转轴通过点 **A** = $(x_{0}, y_{0}, z_{0})$，则 4×4 齐次矩阵为：
$$
M =
\begin{bmatrix}
R_{11} & R_{12} & R_{13} & t_{x} \\
R_{21} & R_{22} & R_{23} & t_{y} \\
R_{31} & R_{32} & R_{33} & t_{z} \\
0 & 0 & 0 & 1
\end{bmatrix}
$$



其中：


$$
t_{x} = x_{0} - \left( R_{11}x_{0} + R_{12}y_{0} + R_{13}z_{0} \right)
$$

$$
t_{y} = y_{0} - \left( R_{21}x_{0} + R_{22}y_{0} + R_{23}z_{0} \right)
$$

$$
t_{z} = z_{0} - \left( R_{31}x_{0} + R_{32}y_{0} + R_{33}z_{0} \right)
$$


# 三维平面对称公式

### 1. 向量形式
已知平面方程：
$$
A x + B y + C z + D = 0
$$
法向量：
$$
\mathbf{n} = (A,B,C), \quad \|\mathbf{n}\| = \sqrt{A^2+B^2+C^2}
$$

点 $\mathbf{p} = (x,y,z)$ 关于平面的对称点 $\mathbf{p}'$：
$$
\mathbf{p}' = \mathbf{p} - \frac{2\,(A x + B y + C z + D)}{A^2+B^2+C^2}\,(A,B,C)
$$

---

### 2. 分量形式
$$
\begin{cases}
x' = x - \dfrac{2A(Ax+By+Cz+D)}{A^2+B^2+C^2} \\
y' = y - \dfrac{2B(Ax+By+Cz+D)}{A^2+B^2+C^2} \\
z' = z - \dfrac{2C(Ax+By+Cz+D)}{A^2+B^2+C^2}
\end{cases}
$$

---

### 3. 齐次矩阵形式（4×4）
$$
M =
I - \frac{2}{A^2+B^2+C^2}
\begin{bmatrix}
A^2 & AB & AC & AD \\
AB & B^2 & BC & BD \\
AC & BC & C^2 & CD \\
0 & 0 & 0 & 0
\end{bmatrix}
$$

变换：

$$
\begin{bmatrix} x^{\prime}\\ y^{\prime}\\ z^{\prime}\\ 1 \end{bmatrix}
= M\,\begin{bmatrix} x\\ y\\ z\\ 1 \end{bmatrix}
$$


# 三维平移的齐次矩阵：

$$
M_{\text{trans}} =
\begin{bmatrix}
1 & 0 & 0 & t_x \\
0 & 1 & 0 & t_y \\
0 & 0 & 1 & t_z \\
0 & 0 & 0 & 1
\end{bmatrix}
$$

平移效果：
$$
\begin{cases}
x' = x + t_x \\
y' = y + t_y \\
z' = z + t_z
\end{cases}
$$


# 关于点 $A(x_0, y_0, z_0)$ 的对称

### 1. 向量公式
$$
\mathbf{p}' = 2\mathbf{a} - \mathbf{p}
$$
其中：
$$
\mathbf{a} = (x_0, y_0, z_0), \quad \mathbf{p} = (x, y, z)
$$

---

### 2. 分量公式
$$
\begin{cases}
x' = 2x_0 - x \\
y' = 2y_0 - y \\
z' = 2z_0 - z
\end{cases}
$$

---

### 3. 齐次矩阵形式（4×4）
$$
M_{\text{point-mirror}} =
\begin{bmatrix}
-1 & 0 & 0 & 2x_0 \\
0 & -1 & 0 & 2y_0 \\
0 & 0 & -1 & 2z_0 \\
0 & 0 & 0 & 1
\end{bmatrix}
$$


变换关系：

$$
x' = -x + 2x_0
$$

$$
y' = -y + 2y_0
$$

$$
z' = -z + 2z_0
$$
