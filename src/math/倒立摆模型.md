# 倒立摆模型
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/996ad63801f947f2b9a948496dab7d3d.png)

## 1. 系统描述与建模假设

### 1.1 系统结构

- 小车质量：$M$，沿水平方向运动  
- 摆杆长度：$l$，刚性杆，质量忽略  
- 摆端小球质量：$m$  
- 摆轴位置$P(x,0)$
- 摆轴旋转角度$\theta$
- 摆端小球位置：$Q(X,Y)$  
- 小车受水平控制力：$F$  

目标：通过控制小车水平控制力$F$  ，使摆杆稳定在倒立位置。

---

### 1.2 广义坐标选取

选取如下广义坐标：

- $x$：小车的水平位移  
- $\theta$：摆杆相对于竖直向上方向的夹角（逆时针为正）

约定倒立平衡点为：

$$
\theta = 0
$$

---

## 2. 运动学关系

### 2.1 摆球位置

摆球在惯性坐标系中的位置为：

$$
\begin{aligned}
X &= x - l\sin\theta \\
Y &= l\cos\theta
\end{aligned}
$$

---

### 2.2 速度表达式

对时间求导：

$$
\begin{aligned}
\dot X &= \dot x - l\dot\theta\cos\theta \\
\dot Y &= -l\dot\theta\sin\theta
\end{aligned}
$$

速度平方为：

$$
\begin{aligned}
v^2
&= \dot X^2 + \dot Y^2 \\
&= \dot x^2 - 2l\dot x\dot\theta\cos\theta + l^2\dot\theta^2
\end{aligned}
$$

---

## 3. 能量表达式

### 3.1 动能 $T$

小车的动能：

$$
T_{\text{cart}} = \frac{1}{2} M \dot x^2
$$

摆球的动能：

$$
T_{\text{pend}} = \frac{1}{2} m v^2
$$

系统总动能：

$$T=\frac{1}{2}(M+m)\dot x^2- ml\dot x\dot\theta\cos\theta+ \frac{1}{2}ml^2\dot\theta^2$$

### 3.2 势能 $V$

以小车铰点高度为零势能参考：

$$
V = m g l \cos\theta
$$

倒立位置 $$\theta = 0$$ 对应势能最大值，是一个不稳定平衡点。

---

## 4. 拉格朗日函数

拉格朗日量定义为：

$$
\mathcal{L} = T - V
$$

代入得：

$$\mathcal{L}=\frac{1}{2}(M+m)\dot x^2- ml\dot x\dot\theta\cos\theta+ \frac{1}{2}ml^2\dot\theta^2- mgl\cos\theta$$

---

## 5. 拉格朗日方程

拉格朗日方程为：

$$\frac{d}{dt}\left(\frac{\partial \mathcal{L}}{\partial \dot q_i}\right)-\frac{\partial \mathcal{L}}{\partial q_i}=
Q_i$$

其中广义力为：

- $$Q_x = F$$  
- $$Q_\theta = 0$$  

---

### 5.1 关于 $x$ 的方程

$$(M+m)\ddot x- ml(\ddot\theta\cos\theta - \dot\theta^2\sin\theta)= F$$

---

### 5.2 关于 $\theta$ 的方程

$$-ml\ddot x\cos\theta+ ml^2\ddot\theta- mgl\sin\theta= 0$$


### 5.3 完整非线性动力学模型

$$
\begin{cases}
(M+m)\ddot x - ml\ddot\theta\cos\theta + ml\dot\theta^2\sin\theta = F \\
 ml^2\ddot\theta-ml\ddot x\cos\theta -mgl\sin\theta = 0
\end{cases}
$$


## 6. 平衡点与线性化

### 6.1 倒立平衡点

$$
\theta = 0,\quad
\dot\theta = 0,\quad
\dot x = 0
$$

小角度近似：

$$
\sin\theta \approx \theta,\qquad
\cos\theta \approx 1
$$



### 6.2 线性化方程

$$
\begin{cases}
(M+m)\ddot x - ml\ddot\theta = F \\
 -ml\ddot x+ml^2\ddot\theta=  mgl\theta 
\end{cases}
$$


## 7. 状态空间表示



$$ \begin{bmatrix} M+m & -ml \\ -ml & ml^2 \end{bmatrix} \begin{bmatrix} \ddot x \\ \ddot\theta \end{bmatrix} = \begin{bmatrix} F \\ mgl\,\theta \end{bmatrix} $$



定义状态向量为：

$$
\mathbf{x} =
\begin{bmatrix}
x \\
\dot x \\
\theta \\
\dot\theta
\end{bmatrix}
$$

控制输入为：

$$
u = F
$$

则系统的状态空间模型可写为：

$$
\dot{\mathbf{x}} =
\begin{bmatrix}
0 & 1 & 0 & 0 \\
0 & 0 & \frac{mg}{M} & 0 \\
0 & 0 & 0 & 1 \\
0 & 0 & \frac{(M+m)g}{Ml} & 0
\end{bmatrix}
\mathbf{x}
+
\begin{bmatrix}
0 \\
\frac{1}{M} \\
0 \\
\frac{1}{Ml}
\end{bmatrix}
u
$$

## 8. 系统特性分析

### 8.1 稳定性分析

- 倒立位置是无控制下的 **不稳定平衡点**  
- 系统矩阵 \(A\) 的特征值分析：
$$
\text{eig}(A) = \text{特征值}
$$
其中必有正实部 → 系统不稳定

### 8.2 可控性与可观性

- 可控性矩阵：
$$
\mathcal{C} = [B, AB, A^2B, A^3B]
$$
- 可观性矩阵：
$$
\mathcal{O} = 
\begin{bmatrix}
C \\
CA \\
CA^2 \\
CA^3
\end{bmatrix}
$$
- 对倒立摆系统，可控且可观，意味着可以通过状态反馈实现稳定控制

---

## 9. 控制器设计

### 9.1 状态反馈控制 

- 控制目标：选择状态反馈增益矩阵 \(K\)，使闭环系统稳定  
- 控制律：
$$
u = -K \mathbf{x}
$$
- 闭环系统：
$$
\dot{\mathbf{x}} = (A - BK)\mathbf{x}
$$

### 9.2 LQR 最优控制

- 代价函数：
$$
J = \int_0^\infty (\mathbf{x}^T Q \mathbf{x} + u^T R u)\, dt
$$
- 求解连续时间 Riccati 方程得到最优反馈增益：
$$
K = R^{-1} B^T P
$$

### 9.3 极点配置 (Pole Placement)

- 根据系统自然频率与阻尼比设计期望闭环极点  
- 使用 MATLAB / Python 的 `place` 或手工设计矩阵 \(K\)

---

## 10. 仿真与验证

- 使用 MATLAB / Simulink 仿真：
  - 非线性模型 + 状态反馈  
  - 初始角度扰动：\(\theta_0 \neq 0\)  
  - 观察 \($\theta$(t)\) 收敛到 0，\(x(t)\) 平稳移动
- 控制力 \(F(t)\) 观察：
  - 是否合理，避免过大饱和
- 可绘制曲线：
  - $\theta(t)$
  - $x(t)$ 
  - 控制输入$(t)$

