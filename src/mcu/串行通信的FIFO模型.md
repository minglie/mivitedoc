# 串行通信的FIFO模型

[有限状态机的九元组定义](https://blog.csdn.net/qq_26074053/article/details/149335857)
## 一、串行通信还原成一件事

无论是 UART、SPI、I²C，还是 HC595、I²S，或自定义的串行总线，本质上都可以还原为同一个模型：

> **宽度为 1、深度为 N 的 FIFO，在时间轴上的受控填充与拷贝**

三个核心要素：

- 存储结构FIFO(动作集受体)  
- 转移集(事件集x动作集）  
- 时间对齐方式(输入转事件的逻辑)  

一旦这三点抽象清楚，串行通信就不再神秘。

---

## 二、核心模型：宽度为 1，深度为 N 的 FIFO

只有串行通信使用同一个模型,才能用同一个[状态机](https://blog.csdn.net/qq_26074053/article/details/149335857)描述它们。
只有用同一个状态机描述他们,才能用一套相似的代码实现它们
### 1. 为什么一定是 FIFO

串行通信的基本事实是：

- 任意时刻只能传输 **1 bit**
- 但语义单位往往是：
  - 8 bit（UART）
  - 16 / 24 / 32 bit（SPI）
  - 或更长的一帧

因此，在任何接收端内部，都必然存在一个 FIFO 或移位寄存器：

bit0 → bit1 → bit2 → ... → bitN-1


其抽象特征是：

- **宽度 = 1 bit**
- **深度 = N**
- **按时间顺序写入**

---

### 2. 写指针：秩序的唯一来源

这个 FIFO 必然伴随一个关键状态量：

> **写指针（Write Pointer）**

它的规则极其简单：

- 每接收 1 个 bit  
  → 写指针 +1
- 写指针的位置  
  → 决定当前 bit 的语义位置

一旦写指针失序，整个通信立即失效。

---

## 三、转移集=事件集x动作集
串行通信真正关心的是“事件”和关联的动作形成的转移集。
从接收端视角看，串行通信并不关心电平本身，而是关心**有限个关键事件及其触发的动作**。


---

### 1️⃣帧起始事件——写指针清零动作 

这是所有串行协议中**最关键的动作**。

不同协议的表现形式不同，但本质一致：

| 协议 | 写指针清零方式 |
|---|---|
| UART | 起始位（Start Bit） |
| SPI | CS 有效 |
| I²C | START 条件 |
| HC595 | 外部约定或锁存逻辑 |
| msl| 总线空闲到非空闲的切换 |
| 自定义协议 | 超时 / 同步序列 |

**起始事件不是“一个特殊的 bit”**，而是：

> **告诉接收端：写指针清零**

---

### 2️⃣ 位同步事件 —— 写指针递增动作

每写入一个 bit，都需要一个明确的同步事件：

> **“现在这一刻，采样并写入 FIFO”**

不同协议对位同步的定义：

| 协议 | 位同步依据 |
|---|---|
| UART | 本地定时器（经起始位校准） |
| SPI | 时钟边沿 |
| I²C | SCL 高电平窗口 |
| HC595 | SHCP 边沿 |
| msl| 电平变化 |

**位同步只解决一件事：bit 对齐**  
它并不关心帧的开始与结束。

---

### 3️⃣ 帧结束事件—— FIFO 提交动作

当 FIFO 填充完成，需要一个事件通知系统：

> **这组 bit 已经构成一个完整语义单元**

常见形式包括：

| 协议 | 提交事件 |
|---|---|
| UART | 停止位 |
| SPI | CS 失效 |
| I²C | STOP 条件 |
| 74HC595 | STCP 锁存 |
| msl| 总线非空闲到空闲的切换 |
| 自定义协议 | 帧长度 / 超时 |

这一步的本质不是接收新 bit，而是：

> **将 FIFO 内容整体提交给上层逻辑**

---

## 四、位同步的本质：不是“有时钟”，而是“采样约定”

无论同步还是异步协议，位同步的目标只有一个：

> **在发送端稳定、接收端可信的时刻采样**

- 同步协议：显式时钟（SPI）
- 异步协议：隐式时钟（UART 定时采样）
- 自定义协议：脉宽、tick 数、边沿规则

**位同步 ≠ 帧同步**  
它只决定“什么时候写指针 +1”。

---

## 五、帧边界切片比特流

起始位、CS、START/STOP、STCP、超时判帧，看似形式不同，本质完全一致：

> **它们都在时间轴上切分 FIFO 的一次完整填充区间**

换句话说：

> **串行通信不是连续比特流，而是被规则切片的比特流**

切片规则(帧边界的判定规则)，是协议的主要差异所在。

---

## 六、统一视角对照

| 协议 | UART | SPI | 74HC595 |
|---|---|---|---|
| FIFO 宽度 | 1 | 1 | 1 |
| FIFO 深度 | 8~9 | 可变 | 固定 8 |
| 写指针清零 | 起始位 | CS有效 | 无(任意状态下输出连续8bit数据覆盖旧数据) |
| 位同步 | 定时采样 | SCLK 边沿 | SHCP |
| 提交事件 | 停止位 | CS 失效 | STCP |
| 自恢复能力 | 强 | 强 | 无 |

---
## 七、关注点总结
“单宽度FIFO” 模型，将串行通信的时序、帧结构与状态控制统一到同一语言中，使得协议层定义可以无歧义地翻译为硬件或软件实现。

- FIFO
- 写指针
- 事件集
- 时间对齐规则
- 写指针什么时候清零  
- 写指针什么时候递增  
- FIFO 什么时候整体提交  

